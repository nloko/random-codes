<html>
  <head>
    <script type='text/javascript'>
	var CELL_SIZE = 5;
	var GRID_SIZE = 500 / CELL_SIZE;
	var grid  = new Array(GRID_SIZE);
        var gen   = new Array(GRID_SIZE);
	var intervalID = 0;

	function fillGeneration() {
	  for (var i = 0; i < grid.length; i++) {
            for (var j = 0; j < grid[i].length; j++) {
	      gen[i][j] = grid[i][j];
	    }
	  }
	}

	function seed(n) {
	  for (var i = 0; i < grid.length; i++) {
	    grid[i] = new Array(GRID_SIZE);
	    gen[i]  = new Array(GRID_SIZE);
            for (var j = 0; j < grid[i].length; j++) {
	      grid[i][j] = gen[i][j] = 0;
	    }
	  }

	  for (var i = 0; i < n; i++) {
	    var x = Math.floor(Math.random() * GRID_SIZE);
	    var y = Math.floor(Math.random() * GRID_SIZE);
	    grid[x][y] = 1;
	  } 
        }

	function neighbours(gen, i, j) {
	  var minX = Math.max(i - 1, 0);
	  var minY = Math.max(j - 1, 0);
	  var maxX = Math.min(i + 1, grid.length - 1);
	  var maxY = Math.min(j + 1, grid.length - 1);

	  var score = 0;

	  for (var x = minX; x <= maxX; x++) {
	    for (var y = minY; y <= maxY; y++) {
	      if (x == i && y == j) continue;
	      if (gen[x][y]) score++;
	    }
	  }

	  return score;
	}

 	function tick() {
	  fillGeneration();
	  for (var i = 0; i < gen.length; i++) {
	    for (var j = 0; j < gen[i].length; j++) { 
	      var score = neighbours(gen, i, j);
	      if (gen[i][j]) {
	        if (score < 2) grid[i][j] = 0;
	        else if (score > 3) grid[i][j] = 0;
	      } else if (score == 3) grid[i][j] = 1;
	    }
	  }
	}

	function draw() {
          var canvas = document.getElementById('conway');
          var ctx = canvas.getContext('2d');

	  for (var i = 0; i < grid.length; i++) {
	    for ( var j = 0; j < grid[i].length; j++) {
	      if (!grid[i][j]) {
                ctx.clearRect(i * CELL_SIZE, j * CELL_SIZE, CELL_SIZE, CELL_SIZE);
	      } else {
	        ctx.fillRect(i * CELL_SIZE, j * CELL_SIZE, CELL_SIZE, CELL_SIZE);
              }
            }
	  }
	}
 
        function play() {
	  if (intervalID) clearInterval(intervalID);
	  
          // create too many and majority will die off due to
	  // overcrowding
	  //
	  seed(GRID_SIZE * GRID_SIZE * 0.4);
	  draw();

	  intervalID = setInterval(function() {
	    tick();
            draw();
          }, 150);
  	}
    </script>
    <style type='text/css'>
       body {
	 font-family: 'Arial', 'sans-serif';
	 text-align: center;
       }

       canvas {
	 display: block;
	 margin: 10px;
	 margin-right: auto;
	 margin-left: auto;
       }

       a.action {
	 color: #000;
	 text-decoration: none;
       }

       a.action:hover {
         text-decoration: underline;
       }
    </style>
  </head>
  <body onload='play();'>
    <h1>Conway's Game of Life</h1>
    <canvas id="conway" width="500px" height="500px"></canvas>
    <div>
      <a class='action' href="http://en.wikipedia.org/wiki/Conway's_Game_of_Life" target="_blank">Huh?</a>
      <a class='action' href="javascript:void(0)" onclick='play();'>Randomize</a>
    </div>
  </body>
</html>
